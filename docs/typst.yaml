$schema: http://json-schema.org/draft-07/schema#
$id: https://jassielof.github.io/json-schemas/docs/typst.schema.json
title: Typst Package Manifest
description: |-
  Schema for typst.toml package manifest files, used by the Typst package manager and universe.
  https://github.com/typst/packages/blob/main/docs/manifest.md
type: object
required:
  - package
properties:
  package:
    type: object
    description: Contains metadata about the package.
    required:
      - name
      - version
      - entrypoint
    properties:
      name:
        type: string
        description: |-
          The package's identifier in its namespace.
          See [Naming rules](https://github.com/typst/packages/blob/main/docs/manifest.md#naming-rules).
        pattern: ^[a-z\d]+(-[a-z\d]+)*$
        examples:
          - my-package
          - example-template
      version:
        type: string
        description: |-
          The package's version as a full major-minor-patch triple (following SemVer, no pre-release or build tags).
          See [SemVer](https://semver.org/).
        pattern: ^\d+\.\d+\.\d+$
        examples:
          - 1.0.0
          - 0.2.1
      entrypoint:
        type: string
        description: The path to the main Typst file (relative to the package root) that is evaluated when the package is imported.
        examples:
          - lib.typ
          - src/main.typ
      authors:
        type: array
        description: |-
          A list of the package's authors. Each author can provide an email address (<user@example.com>), homepage (<https://example.com>), or GitHub handle (<@typst>) in angle brackets.
          Required for Typst Universe submission.
        uniqueItems: true
        items:
          type: string
        minItems: 1
        examples:
          - - Jane Doe <jane.doe@example.com>
            - John Doe <@johndoe>
          - - Typst GmbH <https://typst.app>
      license:
        type: string
        description: |-
          The package's license. Must contain a valid SPDX 2.3 expression describing one or multiple licenses.
          See [Licensing](https://github.com/typst/packages/blob/main/docs/licensing.md).
          Required for Typst Universe submission.
        examples:
          - MIT
          - Apache-2.0
          - GPL-3.0-or-later
          - MIT OR Apache-2.0
          - CC-BY-SA-4.0
      description:
        type: string
        description: |-
          A short, clear description of the package (one sentence recommended). Required for Typst Universe submission.
          Should be 40-60 characters long, terminate with a full stop, avoid "Typst" unless relevant.
          See [Writing a good description](https://github.com/typst/packages/blob/main/docs/manifest.md#writing-a-good-description).
        # According to docs: ideally 40-60 characters, but this is a recommendation not a hard requirement
        minLength: 10 # Added: Reasonable minimum to ensure meaningful description
        maxLength: 200 # Added: Reasonable maximum to keep it concise
      homepage:
        type: string
        description: A link to the package's web presence, where there could be more details, an issue tracker, or something else. Will be linked to from the package list. If there is no dedicated web page for the package, don't link to its repository here. Omit this field and prefer `repository`.
        format: uri
        examples:
          - https://example.com/my-package-docs
      repository:
        type: string
        description: A link to the repository where this package is developed. Will be linked to from Typst Universe if there is no homepage.
        format: uri
        examples:
          - https://github.com/user/my-package
      keywords:
        type: array
        description: An array of search keywords for the package.
        items:
          type: string
          minLength: 1 # Added: Keywords should not be empty strings
        minItems: 1
        uniqueItems: true
        examples:
          - - chart
            - plot
            - data visualization
          - - ieee
            - template
            - paper
      categories:
        type: array
        description: |-
          An array with up to three categories from the official list to help users discover the package.
          See [categories](https://github.com/typst/packages/blob/main/docs/CATEGORIES.md).
        items:
          type: string
          enum:
            # Functional categories
            - components
            - visualization
            - model
            - layout
            - text
            - languages
            - scripting
            - integration
            - utility
            - fun
            # Publication categories
            - book
            - report
            - paper
            - thesis
            - poster
            - flyer
            - presentation
            - cv
            - office
        minItems: 1
        maxItems: 3
        uniqueItems: true
        examples:
          - - visualization
            - components
          - - paper
            - layout
      disciplines:
        type: array
        description: |-
          An array of disciplines from the official list defining the target audience. Should be empty if generally applicable.
          See [disciplines](https://github.com/typst/packages/blob/main/docs/DISCIPLINES.md).
        items:
          type: string
          enum:
            - agriculture
            - anthropology
            - archaeology
            - architecture
            - biology
            - business
            - chemistry
            - communication
            - computer-science
            - design
            - drawing
            - economics
            - education
            - engineering
            - fashion
            - film
            - geography
            - geology
            - history
            - journalism
            - law
            - linguistics
            - literature
            - mathematics
            - medicine
            - music
            - painting
            - philosophy
            - photography
            - physics
            - politics
            - psychology
            - sociology
            - theater
            - theology
            - transportation
        uniqueItems: true
        # Note: minItems not required - can be empty array if generally applicable
        examples:
          - - computer-science
            - mathematics
          - - physics
          - [] # Empty array is valid for generally applicable packages
      compiler:
        type: string
        description: |-
          The minimum Typst compiler version required for this package to work (SemVer format).
          Partial versions like '0' or '0.13' are supported. Pre-release tags are not supported.
        pattern: ^(0|[1-9]\d*)(\.(0|[1-9]\d*)){0,2}$
        examples:
          - "0"
          - "0.13"
          - "0.8.0"
          - "1.0.0"
      exclude:
        type: array
        description: |-
          An array of globs specifying files that should not be part of the published bundle that the compiler downloads when importing the package.
          To be used for large support files like images or PDF documentation that would otherwise unnecessarily increase the bundle size.
          Don't exclude the README or the LICENSE. Template thumbnails are automatically excluded.
        items:
          type: string
          minLength: 1 # Glob patterns should not be empty
        uniqueItems: true # No point in duplicate globs
        examples:
          - - docs/
            - "*.pdf"
            - images/draft*.png
    examples:
      - name: example
        version: 0.1.0
        entrypoint: lib.typ
        authors:
          - The Typst Project Developers
        license: MIT
        description: Calculate elementary arithmetic with functions.
    additionalProperties: false

  template:
    type: object
    description: |-
      If present, declares this package as a template.
      Template packages must specify at least one category.
    required:
      - path
      - entrypoint
      - thumbnail
    properties:
      path:
        type: string
        description: The directory within the package (relative to package root) containing files to be copied into the user's new project directory.
        minLength: 1 # Path should not be empty
        examples:
          - template
          - skeleton
      entrypoint:
        type: string
        description: |-
          Path relative to the template 'path' directory pointing to the main file to be compiled after initialization.
          This file will become the previewed file in the Typst web application.
        minLength: 1 # Entrypoint should not be empty
        pattern: .*\.typ$ # Must be a .typ file
        examples:
          - main.typ
          - report.typ
      thumbnail:
        type: string
        description: |-
          Path relative to the package root pointing to a PNG or lossless WebP thumbnail.
          Requirements: min 1080px on longer edge, max 3 MiB file size.
          _The thumbnail will automatically be excluded from the package files._
        pattern: ^.*\.(png|webp)$
        examples:
          - thumbnail.png
          - preview.webp
    additionalProperties: false

  tool:
    type: object
    description: |-
      Namespace for third-party tools to store their own Typst-specific configuration.
      Each tool should create its own entry under this section.
    propertyNames:
      type: string
      minLength: 1 # Tool names should not be empty
    additionalProperties:
      type: object
    examples:
      - mytool:
          foo: bar

additionalProperties: false

# Conditional validation: if template is present, additional fields are required
allOf:
  - if:
      properties:
        template:
          type: object
      required:
        - template
    then:
      properties:
        package:
          type: object
          required:
            - name
            - version
            - entrypoint
            - authors
            - license
            - description
            - categories # Required for template packages
          properties:
            name:
              type: string
            version:
              type: string
            entrypoint:
              type: string
            authors:
              type: array
            license:
              type: string
            description:
              type: string
            categories:
              type: array
              minItems: 1 # Templates must have at least one category
